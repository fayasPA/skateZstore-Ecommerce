{% extends 'base.html' %}
{% load static %}


{% block index %}


<section>
<div class=" w-100" style="height:90vh;">
    <div class="h-100 row d-flex justify-content-center align-items-center">
            <div class="card ">
                <div class="d-flex justify-content-center">
                <span>Amount to be paid=</span><h5 id="tot_amnt">{{tot_amnt}}</h5>
                </div>
                <div class="btn btn-outline-dark" id="rzp-button1">Pay with RazorPay</div>
            </div>
    </div>
</div>
</section>









{% endblock %}

{% block lowerBodyScript %}
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
  $(document).ready(function () {
    $("#rzp-button1").click(function (e) {
      var total = $("#tot_amnt").text();      //Get Total amnt
      var token = $("input[name='csrfmiddlewaretoken']").val()  //Taking value of CSRF token by name
      console.log(token)
      var options = {
        "key": "rzp_test_8SI81tn60Ec0O4", // Enter the Key ID generated from the Dashboard
        "amount": total, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
        "currency": "INR",
        "name": "SkateBuddy",
        "description": "Thank You for Supporting SkateBuddy",
        //"image": "https://example.com/your_logo",
        //"order_id": "order_9A33XWu170gUtm", //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
        "handler": function (response){
            /* alert(response.razorpay_payment_id);
            alert(response.razorpay_order_id);
            alert(response.razorpay_signature)  */
            data = {
              "trans_id": response.razorpay_payment_id,
              //'csrfmiddlewaretoken': token
            }
            $.ajax({
              type: "GET",
              url: "/razorpay",
              data: data,
              success: function (response) {
                console.log(response.status)
                swal.fire({
                  title: "Payment Successful",
                  text: response.status,
                  icon: "success",
                  button: "OK",
                }).then(function () {
                  window.location.href = "/";
                });
              }
            });
            
        },
        "prefill": {
            "name": "Fayas",
            "email": "fayman619@gmail.com",
            "contact": "9496715606"
        },
        "notes": {
            "address": "Razorpay Corporate Office"
        },
        "theme": {
            "color": "#3399cc"
        }
    };
    var rzp1 = new Razorpay(options);
    rzp1.open();
    })

  })

</script>
{% endblock %}